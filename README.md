Mock tool
==================

モックアップの作成ツールです。

ディレクトリ構造
-----------------

```
{mook_tool_root}/
├ LICENSE
├ README.md
├ src/ => モックアップのもととなるテンプレートを配置するディレクトリです。
├ dist/ => 生成されたモックアップがこのディレクトリに出力されます。
├ docs/ => ドキュメント用ディレクトリです。
├ bin/ => 各種スクリプト格納ディレクトリです。
├ package.json
├ tsconfig.json
└ [vars.yml] => テンプレートの変数定義ファイルです。(必要に応じて作成してください)
```

セットアップ方法
-----------------

### 依存パッケージをインストールします

以下のいずれかのコマンドを実行し、依存パッケージをインストールします。

```
npm install 
```

または

```
yarn install
```

使い方
-----------------

VSCodeを起動後、画面左下の`NPMスクリプト`より  
`server`の`▷`マークをクリックして、簡易Webサーバーを起動します。

![スナップショット](./docs/images/vscode_snapshot.png)

`src`ディレクトリにモックアップのテンプレートを作成していきます。

テンプレートファイルの変更があった場合、ブラウザの自動リロードが行われ  
変更内容が画面に反映されます。

### 監視対象ファイルの拡張子

`src`ディレクトリ内の以下のファイルの更新を監視し、  
変更があった場合に自動的に再ビルドを行い、ブラウザをリロードます。

* `*.njk`
* `*.twig`
* `*.html`
* `vars.yml`
* `*.ts`
* `*.js`
* `*.scss`
* `*.sass`

HTMLの生成について
-----------------

テンプレートエンジンを利用することで、  
複数の画面で利用する共通のパーツを別ファイルとして切り出し、  
切り出したパーツファイルを呼び出すことで複数の画面で再利用できます。

モックアップのテンプレートエンジンに[Nunjucks](https://mozilla.github.io/nunjucks/)を利用しています。

テンプレートの記法については、以下の公式サイトを参照してください。

[Nunjucks](https://mozilla.github.io/nunjucks/)

### 設定の初期値

* ソースディレクトリ：`src`
* 出力先ディレクトリ：`dist`
* 監視対象ファイルの拡張子：`njk`または`twig`または`html`
* 変数ファイル名：`vars.yml`
* ページ情報の出力ファイル名：`pages.json`

上記の各種設定は`.env`ファイルに記述することで変更可能です。

#### `.env`ファイルの設定例

```sh
## ソースディレクトリ
SOURCE_NUNJUCKS_DIR=src
## 出力先ディレクトリ
OUTPUT_HTML_DIR=dist
## 監視対象ファイルの拡張子
# NUNJUCKS_FILE_PATTERN=njk,twig,html
## 変数ファイル名
# NUNJUCKS_VAR_FILE=vars.yml
## コンパイル済みページ情報の出力ファイル名
# NUNJUCKS_COMPILED_PAGE_LIST_FILE=pages.json
```

### パーツファイルについて

`_`で始まるファイル、または、ディレクトリ内のファイルはパーツとして扱われ、  
モックアップとしては生成されません。

#### ファイル名の例

パーツとして認識されるファイルの例は以下のとおりです。

* `_header.njk`
* `_menu.njk`
* `_footer.njk`
* `_partial/header.njk`
* `_partial/menu.njk`
* `_partial/footer.njk`
* `_layout/default.njk`

### 変数ファイルについて

ページに出力する内容を変数として定義することができます。
変数ファイルは`vars.yml`というファイル名で、  
プロジェクトディレクトリまたは、`src`ディレクトリ内に配置します。

変数ファイルは各ディレクトリごとに定義することができ、
ディレクトリ内に定義された変数は、そのディレクトリ以下のファイルで利用することができます。

#### 変数ファイルの例

```yml
---
base_url: http://example.com/
title: サイトのタイトル
description: サイトの説明
keywords: サイトのキーワード
author: サイトの著者
```

### 利用可能なコマンドライン引数

* `--watch` または `-w`：
    * ファイルの変更を監視し、変更があった場合に自動的に再ビルドします。
* `--production`：
    * このパラメーターがあるか場合はサイトマップファイルを生成します。
    * 出力先ディレクトリに`sitemap.xml`が生成されます。
* `--debug`：
    * ファイルの監視状況などをコンソールに出力します。

### サイトマップファイル用変数について

* `base_url`：サイトのベースURLを設定します。
* `sitemap_lastmod`：サイトマップに出力するページの最終更新日を設定します。
    * この変数の値に`git`が設定されている場合は、Gitのコミット履歴から最終更新日を取得します。
    * この変数の値に`file`が設定されている場合は、ファイルの更新日から最終更新日を取得します。
        * ※パーシャルファイルを更新した場合でも、コンパイル対象ファイルの最終更新日が出力されます。
    * この変数の値にその他の値されている場合は、設定された値をそのまま出力します。
* `sitemap_changefreq`：サイトマップに出力するページの更新頻度を設定します。
* `sitemap_priority`：サイトマップに出力するページの優先度を設定します。

サイトマップファイルの詳細については以下のページなどを参照してください。
https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=ja#xml

CSSの生成について
-----------------

* [Sass](https://www.npmjs.com/package/sass)を利用しています。

### 設定の初期値

* ソースディレクトリ：`scss`
* 出力先ディレクトリ：`css`
* 監視対象ファイルの拡張子：`scss`または`sass`
* パーシャルとして認識するファイルの接頭語：`_`
* パーシャルから除外するファイルの接尾語：`-bk`
* インデックスファイル及びコンパイルから除外するディレクトリの接尾語：`未設定`
* インデックスファイルのファイル名：`_index.scss`
    * 各ディレクトリ内のSassファイルをインポートするためのファイルです。
* マスターSassファイルのファイル名：`style.scss`
    * インデックスファイルをインポートするためのファイルです。
    * このファイルは対象ディレクトリ直下にのみ生成されます。

上記の各種設定は`.env`ファイルに記述することで変更可能です。

#### `.env`ファイルの設定例

```sh
## ソースディレクトリ
SOURCE_SCSS_DIR=src/scss
## 出力先ディレクトリ
OUTPUT_CSS_DIR=dist/assets/css
## 監視対象ファイルの拡張子
# SCSS_FILE_EXTENSIONS=scss,sass
## インデックスファイルのファイル名
# SCSS_INDEX_FILE_NAME=_index.scss
## パーシャルとして認識するファイルの接頭語
# SCSS_INCLUDE_FILE_PREFIX=_
## パーシャルから除外するファイルの接尾語
# SCSS_EXCLUDE_FILE_SUFFIX=-bk
## インデックス及びコンパイルから除外するディレクトリの接尾語
# SCSS_EXCLUDE_DIR_SUFFIX=
## マスターSassファイルのファイル名
# SCSS_MAIN_FILE=style.scss
```

### 利用可能なコマンドライン引数

* `--watch` または `-w`：
    * ファイルの変更を監視し、変更があった場合に自動的に再ビルドします。
* `--production`：
    * このパラメーターがあるか否かCSSの出力形式の切り替えを行っています。
        * `--production`無し：`expanded`形式で出力します。
        * `--production`有り：`compressed`形式で出力します。
* `--debug`：
    * ファイルの監視状況などをコンソールに出力します。
